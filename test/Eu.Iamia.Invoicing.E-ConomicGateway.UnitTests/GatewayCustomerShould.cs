using System.Net;
using NSubstitute;

namespace Eu.Iamia.Invoicing.E_ConomicGateway.UnitTests;

[NCrunch.Framework.Category("Unit")]
public class GatewayCustomerShould : GatewayBaseShould
{
    protected override string ResponseOK => "{\n\"collection\": [\n{\n\"customerNumber\": 1,\n\"currency\": \"DKK\",\n\"paymentTerms\": {\n\"paymentTermsNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/payment-terms/1?demo=true\"\n},\n\"customerGroup\": {\n\"customerGroupNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/customer-groups/1?demo=true\"\n},\n\"address\": \"Avenue des Arts No 5\",\n\"balance\": 800,\n\"dueAmount\": 800,\n\"city\": \"Brussels\",\n\"country\": \"Belgium\",\n\"email\": \"customerone@mailinator.com\",\n\"name\": \"Decathlon\",\n\"zip\": \"1040\",\n\"telephoneAndFaxNumber\": \"08343242525\",\n\"vatZone\": {\n\"vatZoneNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/vat-zones/1?demo=true\"\n},\n\"attention\": {\n\"customerContactNumber\": 1,\n\"customer\": {\n\"customerNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/customers/1?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/1/contacts/1?demo=true\"\n},\n\"customerContact\": {\n\"customerContactNumber\": 2,\n\"customer\": {\n\"customerNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/customers/1?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/1/contacts/2?demo=true\"\n},\n\"salesPerson\": {\n\"employeeNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/employees/1?demo=true\"\n},\n\"lastUpdated\": \"2022-06-02T08:53:29Z\",\n\"contacts\": \"https://restapi.e-conomic.com/customers/1/contacts?demo=true\",\n\"defaultDeliveryLocation\": {\n\"deliveryLocationNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/customers/1/delivery-locations/1?demo=true\"\n},\n\"templates\": {\n\"invoice\": \"https://restapi.e-conomic.com/customers/1/templates/invoice?demo=true\",\n\"invoiceLine\": \"https://restapi.e-conomic.com/customers/1/templates/invoiceline?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/1/templates?demo=true\"\n},\n\"totals\": {\n\"drafts\": \"https://restapi.e-conomic.com/invoices/totals/drafts/customers/1?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/invoices/totals/booked/customers/1?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/1/totals?demo=true\"\n},\n\"deliveryLocations\": \"https://restapi.e-conomic.com/customers/1/delivery-locations?demo=true\",\n\"invoices\": {\n\"drafts\": \"https://restapi.e-conomic.com/customers/1/invoices/drafts?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/customers/1/invoices/booked?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/1/invoices?demo=true\"\n},\n\"mobilePhone\": \"066567657657575\",\n\"eInvoicingDisabledByDefault\": false,\n\"self\": \"https://restapi.e-conomic.com/customers/1?demo=true\"\n},\n{\n\"customerNumber\": 2,\n\"currency\": \"DKK\",\n\"paymentTerms\": {\n\"paymentTermsNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/payment-terms/1?demo=true\"\n},\n\"customerGroup\": {\n\"customerGroupNumber\": 2,\n\"self\": \"https://restapi.e-conomic.com/customer-groups/2?demo=true\"\n},\n\"address\": \"Avenue des arts no 3\",\n\"balance\": 12892.62,\n\"dueAmount\": 12892.62,\n\"city\": \"Brussels\",\n\"country\": \"Belgium\",\n\"email\": \"customerw@mailinator.com\",\n\"name\": \"Intersport\",\n\"zip\": \"1212\",\n\"telephoneAndFaxNumber\": \"098786657\",\n\"vatZone\": {\n\"vatZoneNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/vat-zones/1?demo=true\"\n},\n\"attention\": {\n\"customerContactNumber\": 3,\n\"customer\": {\n\"customerNumber\": 2,\n\"self\": \"https://restapi.e-conomic.com/customers/2?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/2/contacts/3?demo=true\"\n},\n\"customerContact\": {\n\"customerContactNumber\": 4,\n\"customer\": {\n\"customerNumber\": 2,\n\"self\": \"https://restapi.e-conomic.com/customers/2?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/2/contacts/4?demo=true\"\n},\n\"salesPerson\": {\n\"employeeNumber\": 4,\n\"self\": \"https://restapi.e-conomic.com/employees/4?demo=true\"\n},\n\"lastUpdated\": \"2022-06-02T08:54:01Z\",\n\"contacts\": \"https://restapi.e-conomic.com/customers/2/contacts?demo=true\",\n\"defaultDeliveryLocation\": {\n\"deliveryLocationNumber\": 2,\n\"self\": \"https://restapi.e-conomic.com/customers/2/delivery-locations/2?demo=true\"\n},\n\"templates\": {\n\"invoice\": \"https://restapi.e-conomic.com/customers/2/templates/invoice?demo=true\",\n\"invoiceLine\": \"https://restapi.e-conomic.com/customers/2/templates/invoiceline?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/2/templates?demo=true\"\n},\n\"totals\": {\n\"drafts\": \"https://restapi.e-conomic.com/invoices/totals/drafts/customers/2?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/invoices/totals/booked/customers/2?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/2/totals?demo=true\"\n},\n\"deliveryLocations\": \"https://restapi.e-conomic.com/customers/2/delivery-locations?demo=true\",\n\"invoices\": {\n\"drafts\": \"https://restapi.e-conomic.com/customers/2/invoices/drafts?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/customers/2/invoices/booked?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/2/invoices?demo=true\"\n},\n\"mobilePhone\": \"03435436\",\n\"eInvoicingDisabledByDefault\": false,\n\"self\": \"https://restapi.e-conomic.com/customers/2?demo=true\"\n},\n{\n\"customerNumber\": 3,\n\"currency\": \"DKK\",\n\"paymentTerms\": {\n\"paymentTermsNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/payment-terms/1?demo=true\"\n},\n\"customerGroup\": {\n\"customerGroupNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/customer-groups/1?demo=true\"\n},\n\"address\": \"Avenue des Arts No 1\",\n\"balance\": 0,\n\"dueAmount\": 0,\n\"city\": \"Brussels\",\n\"country\": \"Belgium\",\n\"email\": \"barredcustomer@mailinator.com\",\n\"barred\": true,\n\"name\": \"Barred customer\",\n\"zip\": \"1212\",\n\"telephoneAndFaxNumber\": \"0645647547\",\n\"vatZone\": {\n\"vatZoneNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/vat-zones/1?demo=true\"\n},\n\"attention\": {\n\"customerContactNumber\": 5,\n\"customer\": {\n\"customerNumber\": 3,\n\"self\": \"https://restapi.e-conomic.com/customers/3?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/3/contacts/5?demo=true\"\n},\n\"customerContact\": {\n\"customerContactNumber\": 6,\n\"customer\": {\n\"customerNumber\": 3,\n\"self\": \"https://restapi.e-conomic.com/customers/3?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/3/contacts/6?demo=true\"\n},\n\"salesPerson\": {\n\"employeeNumber\": 4,\n\"self\": \"https://restapi.e-conomic.com/employees/4?demo=true\"\n},\n\"lastUpdated\": \"2022-05-31T09:30:43Z\",\n\"contacts\": \"https://restapi.e-conomic.com/customers/3/contacts?demo=true\",\n\"defaultDeliveryLocation\": {\n\"deliveryLocationNumber\": 3,\n\"self\": \"https://restapi.e-conomic.com/customers/3/delivery-locations/3?demo=true\"\n},\n\"templates\": {\n\"invoice\": \"https://restapi.e-conomic.com/customers/3/templates/invoice?demo=true\",\n\"invoiceLine\": \"https://restapi.e-conomic.com/customers/3/templates/invoiceline?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/3/templates?demo=true\"\n},\n\"totals\": {\n\"drafts\": \"https://restapi.e-conomic.com/invoices/totals/drafts/customers/3?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/invoices/totals/booked/customers/3?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/3/totals?demo=true\"\n},\n\"deliveryLocations\": \"https://restapi.e-conomic.com/customers/3/delivery-locations?demo=true\",\n\"invoices\": {\n\"drafts\": \"https://restapi.e-conomic.com/customers/3/invoices/drafts?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/customers/3/invoices/booked?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/3/invoices?demo=true\"\n},\n\"mobilePhone\": \"075754747\",\n\"eInvoicingDisabledByDefault\": false,\n\"self\": \"https://restapi.e-conomic.com/customers/3?demo=true\"\n},\n{\n\"customerNumber\": 4,\n\"currency\": \"DKK\",\n\"paymentTerms\": {\n\"paymentTermsNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/payment-terms/1?demo=true\"\n},\n\"customerGroup\": {\n\"customerGroupNumber\": 3,\n\"self\": \"https://restapi.e-conomic.com/customer-groups/3?demo=true\"\n},\n\"address\": \"Avenue des arts 4\",\n\"balance\": 1812.5,\n\"dueAmount\": 1812.5,\n\"corporateIdentificationNumber\": \"00067059\",\n\"city\": \"Copenhagen\",\n\"country\": \"Denmark\",\n\"ean\": \"9777754517245\",\n\"email\": \"customer4@mailinator.com\",\n\"name\": \"Customer with EAN\",\n\"zip\": \"3221\",\n\"telephoneAndFaxNumber\": \"656474747\",\n\"vatZone\": {\n\"vatZoneNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/vat-zones/1?demo=true\"\n},\n\"attention\": {\n\"customerContactNumber\": 7,\n\"customer\": {\n\"customerNumber\": 4,\n\"self\": \"https://restapi.e-conomic.com/customers/4?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/4/contacts/7?demo=true\"\n},\n\"customerContact\": {\n\"customerContactNumber\": 8,\n\"customer\": {\n\"customerNumber\": 4,\n\"self\": \"https://restapi.e-conomic.com/customers/4?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/4/contacts/8?demo=true\"\n},\n\"salesPerson\": {\n\"employeeNumber\": 6,\n\"self\": \"https://restapi.e-conomic.com/employees/6?demo=true\"\n},\n\"lastUpdated\": \"2022-06-07T09:12:33Z\",\n\"contacts\": \"https://restapi.e-conomic.com/customers/4/contacts?demo=true\",\n\"defaultDeliveryLocation\": {\n\"deliveryLocationNumber\": 4,\n\"self\": \"https://restapi.e-conomic.com/customers/4/delivery-locations/4?demo=true\"\n},\n\"templates\": {\n\"invoice\": \"https://restapi.e-conomic.com/customers/4/templates/invoice?demo=true\",\n\"invoiceLine\": \"https://restapi.e-conomic.com/customers/4/templates/invoiceline?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/4/templates?demo=true\"\n},\n\"totals\": {\n\"drafts\": \"https://restapi.e-conomic.com/invoices/totals/drafts/customers/4?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/invoices/totals/booked/customers/4?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/4/totals?demo=true\"\n},\n\"deliveryLocations\": \"https://restapi.e-conomic.com/customers/4/delivery-locations?demo=true\",\n\"invoices\": {\n\"drafts\": \"https://restapi.e-conomic.com/customers/4/invoices/drafts?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/customers/4/invoices/booked?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/4/invoices?demo=true\"\n},\n\"mobilePhone\": \"0964646474\",\n\"eInvoicingDisabledByDefault\": false,\n\"self\": \"https://restapi.e-conomic.com/customers/4?demo=true\"\n},\n{\n\"customerNumber\": 5,\n\"currency\": \"EUR\",\n\"paymentTerms\": {\n\"paymentTermsNumber\": 1,\n\"self\": \"https://restapi.e-conomic.com/payment-terms/1?demo=true\"\n},\n\"customerGroup\": {\n\"customerGroupNumber\": 4,\n\"self\": \"https://restapi.e-conomic.com/customer-groups/4?demo=true\"\n},\n\"address\": \"Avenue Centrale No 3\",\n\"balance\": 0,\n\"dueAmount\": 0,\n\"city\": \"Paris\",\n\"country\": \"France\",\n\"email\": \"freres@mailinator.com\",\n\"name\": \"Les Freres Heureux\",\n\"zip\": \"1231\",\n\"telephoneAndFaxNumber\": \"5475685685\",\n\"vatZone\": {\n\"vatZoneNumber\": 17,\n\"self\": \"https://restapi.e-conomic.com/vat-zones/17?demo=true\"\n},\n\"attention\": {\n\"customerContactNumber\": 15,\n\"customer\": {\n\"customerNumber\": 5,\n\"self\": \"https://restapi.e-conomic.com/customers/5?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/5/contacts/15?demo=true\"\n},\n\"customerContact\": {\n\"customerContactNumber\": 16,\n\"customer\": {\n\"customerNumber\": 5,\n\"self\": \"https://restapi.e-conomic.com/customers/5?demo=true\"\n},\n\"self\": \"https://restapi.e-conomic.com/customers/5/contacts/16?demo=true\"\n},\n\"salesPerson\": {\n\"employeeNumber\": 2,\n\"self\": \"https://restapi.e-conomic.com/employees/2?demo=true\"\n},\n\"lastUpdated\": \"2022-06-07T12:09:44Z\",\n\"contacts\": \"https://restapi.e-conomic.com/customers/5/contacts?demo=true\",\n\"defaultDeliveryLocation\": {\n\"deliveryLocationNumber\": 5,\n\"self\": \"https://restapi.e-conomic.com/customers/5/delivery-locations/5?demo=true\"\n},\n\"templates\": {\n\"invoice\": \"https://restapi.e-conomic.com/customers/5/templates/invoice?demo=true\",\n\"invoiceLine\": \"https://restapi.e-conomic.com/customers/5/templates/invoiceline?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/5/templates?demo=true\"\n},\n\"totals\": {\n\"drafts\": \"https://restapi.e-conomic.com/invoices/totals/drafts/customers/5?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/invoices/totals/booked/customers/5?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/5/totals?demo=true\"\n},\n\"deliveryLocations\": \"https://restapi.e-conomic.com/customers/5/delivery-locations?demo=true\",\n\"invoices\": {\n\"drafts\": \"https://restapi.e-conomic.com/customers/5/invoices/drafts?demo=true\",\n\"booked\": \"https://restapi.e-conomic.com/customers/5/invoices/booked?demo=true\",\n\"self\": \"https://restapi.e-conomic.com/customers/5/invoices?demo=true\"\n},\n\"mobilePhone\": \"09675675685\",\n\"eInvoicingDisabledByDefault\": false,\n\"self\": \"https://restapi.e-conomic.com/customers/5?demo=true\"\n}\n],\n\"pagination\": {\n\"skipPages\": 0,\n\"pageSize\": 20,\n\"maxPageSizeAllowed\": 1000,\n\"results\": 5,\n\"resultsWithoutFilter\": 5,\n\"firstPage\": \"https://restapi.e-conomic.com/customers?skippages=0&pagesize=20&demo=true\",\n\"lastPage\": \"https://restapi.e-conomic.com/customers?skippages=0&pagesize=20&demo=true\"\n},\n\"metaData\": {\n\"create\": {\n\"description\": \"Create a new customer\",\n\"href\": \"https://restapi.e-conomic.com/customers?skippages=0&pagesize=20&demo=true\",\n\"httpMethod\": \"post\"\n}\n},\n\"self\": \"https://restapi.e-conomic.com/customers?skippages=0&pagesize=20&demo=true\"\n}";

    [Fact]
    public async Task ReadCustomersPaged_When_OKResponse_Handle_Success()
    {
        MockResponse(HttpStatusCode.OK);


        using var sut = GetSut;

        var result = await sut.ReadCustomersPaged(0, 20, Cts.Token);

        Mock.VerifyAll();
        MockedReport.Received(0).Error(Arg.Any<string>(), Arg.Any<string>());
        MockedReport.Received(0).Info(Arg.Any<string>(), Arg.Any<string>());

        Assert.NotNull(result);
    }

    [Theory]
    [InlineData(HttpStatusCode.Created)]
    [InlineData(HttpStatusCode.NoContent)]
    [InlineData(HttpStatusCode.BadRequest)]
    [InlineData(HttpStatusCode.Unauthorized)]
    [InlineData(HttpStatusCode.Forbidden)]
    [InlineData(HttpStatusCode.NotFound)]
    [InlineData(HttpStatusCode.MethodNotAllowed)]
    [InlineData(HttpStatusCode.UnsupportedMediaType)]
    [InlineData(HttpStatusCode.InternalServerError)]
    [InlineData(HttpStatusCode.NotImplemented)]
    public async Task ReadCustomersPaged_When_UnexpectedStatus_Handle_HttpRequestException(HttpStatusCode statusCode)
    {
        MockResponse(statusCode);

        using var sut = GetSut;

        var _ = await Assert.ThrowsAsync<HttpRequestException>(() => sut.ReadCustomersPaged(0, 20, Cts.Token));
        MockedReport.Received(1).Error(Arg.Is<string>("ReadCustomersPaged"), Arg.Any<string>());
        MockedReport.Received(0).Info(Arg.Any<string>(), Arg.Any<string>());

        Mock.VerifyAll();
    }
}
